[
    {
        "context": "Editor",
        "bindings": {
            "ctrl-f ctrl-f": "editor::Format",
            "ctrl-f ctrl-0": "editor::FoldAll",
            "ctrl-f ctrl-f": "editor::ToggleFold",
            "ctrl-f ctrl-1": "editor::FoldAtLevel_1",
            "ctrl-f ctrl-2": "editor::FoldAtLevel_2",
            "ctrl-f ctrl-3": "editor::FoldAtLevel_3",
            "ctrl-f ctrl-4": "editor::FoldAtLevel_4",
            "ctrl-f ctrl-5": "editor::FoldAtLevel_5",
            "ctrl-f ctrl-6": "editor::FoldAtLevel_6",
            "ctrl-f ctrl-7": "editor::FoldAtLevel_7",
            "ctrl-f ctrl-8": "editor::FoldAtLevel_8",
            "ctrl-f ctrl-9": "editor::FoldAtLevel_9",
            "ctrl-f ctrl-u": "editor::UnfoldAll"
        }
    },
    {
        "context": "Workspace",
        "bindings": {
            "cmd-shift-r": "workspace::ToggleRightDock",
            "cmd-shift-e": "workspace::ToggleLeftDock",
            // "Nudge" the dock wider with Right Arrow
            "ctrl-alt-]": [
                "workspace::IncreaseActiveDockSize",
                {
                    "px": 100
                }
            ],
            // "Nudge" the dock thinner with Left Arrow
            "ctrl-alt-[": [
                "workspace::DecreaseActiveDockSize",
                {
                    "px": 100
                }
            ],
            // // Reset to the default "Thin" size with Down Arrow
            // "ctrl-alt-\\": "workspace::ResetActiveDockSize"
            "ctrl-/": "agent::ToggleFocus",
            "cmd-s": "workspace::SaveWithoutFormat",
            "cmd-shift-s": "workspace::Save",
            "ctrl-cmd-s": "workspace::SaveAs"
        }
    },
    // {
    //     "context": "Editor",
    //     "bindings": {
    //         "ctrl-alt-]": [
    //             "pane::AdjustFlex",
    //             {
    //                 "amount": 0.05,
    //                 "axis": "horizontal"
    //             }
    //         ],
    //         "ctrl-alt-[": [
    //             "pane::AdjustFlex",
    //             {
    //                 "amount": -0.05,
    //                 "axis": "horizontal"
    //             }
    //         ]
    //     }
    // },
    {
        "context": "Pane && !Terminal",
        "bindings": {
            "ctrl-t h": "workspace::ActivatePaneLeft",
            "ctrl-t l": "workspace::ActivatePaneRight",
            "ctrl-t k": "workspace::ActivatePaneUp",
            "ctrl-t j": "workspace::ActivatePaneDown",
            "ctrl-t ctrl-h": "workspace::ActivatePaneLeft",
            "ctrl-t ctrl-l": "workspace::ActivatePaneRight",
            "ctrl-t ctrl-k": "workspace::ActivatePaneUp",
            "ctrl-t ctrl-j": "workspace::ActivatePaneDown"
        }
    },
    {
        "bindings": {
            "cmd-b": "project_panel::ToggleHideHidden",
            "cmd-shift-c cmd-shift-b": "collab_panel::ToggleFocus",
            "cmd-shift-c": "project_panel::FoldDirectory",
            "cmd-shift-c cmd-shift-u": "project_panel::UnfoldDirectory",
            "ctrl-j ctrl-j": "debugger::StepOver",
            "ctrl-o ctrl-o": "debugger::StepOut",
            "ctrl-b ctrl-b": "debugger::StepBack",
            "ctrl-r ctrl-r": "debugger::Restart",
            "ctrl-d ctrl-e": "debugger::Stop",
            "ctrl-d ctrl-d": "debugger::Detach"
        }
    },
    {
        "context": "(Workspace && debugger_running)",
        "bindings": {
            "ctrl-i ctrl-i": "debugger::StepInto"
        }
    },
    {
        "context": "(Workspace && debugger_stopped)",
        "bindings": {
            "ctrl-c ctrl-c": "debugger::Continue"
        }
    },
    {
        "context": "!ContextEditor > (Editor && mode == full)",
        "bindings": {
            "ctrl-k": "assistant::InlineAssist"
        }
    },
    {
        "context": "Terminal",
        "bindings": {
            "ctrl-k": "assistant::InlineAssist"
        }
    },
    {
        "bindings": {
            "cmd-t": "terminal_panel::ToggleFocus"
        }
    },
    {
        "context": "Workspace",
        "bindings": {
            "cmd-shift-t": "terminal_panel::Toggle"
        }
    },
    {
        "context": "(Editor && edit_prediction)",
        "bindings": {
            "tab": "editor::AcceptEditPrediction"
        }
    },
    {
        "context": "InlineAssistEditor",
        "bindings": {
            "ctrl-enter": "menu::Confirm",
            "cmd-enter": "menu::Confirm"
        }
    },
    {
        "context": "Editor",
        "bindings": {
            "ctrl-f ctrl-m": "editor::Format"
        }
    },
    {
        "context": "Editor",
        "bindings": {
            "ctrl-cmd-f": "editor::Format"
        }
    },
    {
        "context": "VimControl && !menu",
        "bindings": {
            "ctrl-e": [
                "editor::MoveDownByLines",
                {
                    "lines": 5
                }
            ],
            "ctrl-y": [
                "editor::MoveUpByLines",
                {
                    "lines": 5
                }
            ]
        }
    },
    {
        "context": "ProjectPanel",
        "bindings": {
            "cmd-shift-c": "project_panel::CollapseAllEntries"
        }
    },
    {
        "context": "Workspace",
        "bindings": {
            "ctrl-shift-m": "workspace::ToggleZoom"
        }
    },
    {
        "context": "ProjectSearchBar",
        "bindings": {
            "cmd-shift-r": "search::ToggleReplace"
        }
    },
    {
        "context": "ProjectSearchView",
        "bindings": {
            "cmd-shift-r": "search::ToggleReplace"
        }
    },
    {
        "context": "Pane",
        "bindings": {
            "cmd-shift-r": "search::ToggleReplace"
        }
    },
    {
        "context": "BufferSearchBar",
        "bindings": {
            "cmd-shift-r": "search::ToggleReplace"
        }
    },
    {
        "context": "Editor && vim_mode == normal",
        "bindings": {
            "tab": "editor::Indent",
            "shift-tab": "editor::Outdent"
        }
    },
    {
        "context": "Editor && vim_mode == visual",
        "bindings": {
            "tab": "editor::Indent",
            "shift-tab": "editor::Outdent"
        }
    },
    {
        "context": "ContextEditor > Editor",
        "bindings": {
            "cmd-enter": "assistant::ConfirmCommand"
        }
    },
    {
        "context": "ContextEditor > Editor",
        "bindings": {
            "ctrl-enter": "assistant::ConfirmCommand"
        }
    },
    {
        "context": "Editor && vim_mode == normal",
        "bindings": {
            // --- NORMAL MODE (Keep this, as you confirmed it works) ---
            // 1. Alias the internal Delete operator to a hidden key
            "ctrl-shift-d": [
                "vim::PushOperator",
                "Delete"
            ],
            // 2. Map 'dd' to use black hole register + hidden delete operator + current line
            "d d": [
                "workspace::SendKeystrokes",
                "\" _ ctrl-shift-d d"
            ],
            // 3. Map 'D' to use black hole register + hidden delete operator + end of line
            "shift-d": [
                "workspace::SendKeystrokes",
                "\" _ ctrl-shift-d shift-4"
            ]
        }
    },
    {
        "context": "Editor && vim_mode == visual",
        "bindings": {
            // --- VISUAL MODE FIX ---
            // We map 'd' to send the keystrokes: " _ x
            // 1. " _  -> Select Black Hole Register
            // 2. x    -> Trigger standard Cut (which performs the deletion)
            "d": [
                "workspace::SendKeystrokes",
                "\" _ x"
            ]
        }
    }
]
